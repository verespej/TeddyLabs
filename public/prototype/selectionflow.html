<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Sticky Footer Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <script src="bower_components/jquery/jquery.min.js"></script>
    <script src="bower_components/underscore/underscore-min.js"></script>

    <!-- Custom styles for this template -->
    <link href="sticky-footer.css" rel="stylesheet">

    <style>
      .thumbnail {
        -webkit-transition: all 0.5s ease-in-out;
      }
    </style>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->

    <script>
      $.urlParam = function(name){
          var results = new RegExp('[\\?&amp;]' + name + '=([^&amp;#]*)').exec(window.location.href);
          if(!results) return undefined;
          return results[1] || 0;
      }

      var filteredData;
      var currentLeft;
      var currentRight;

      function affirm(elem, color) {
        elem.closest('.thumbnail').css('box-shadow', '0 0 25px ' + color);
        setTimeout(function(){
          elem.closest('.thumbnail').css('box-shadow', 'none');
        }, 500)
      }

      // Swap out element with something not in the dont show list
      function swapout(elem) {
        next = _.chain(filteredData).reject(function(datum){
          if(_([currentRight, currentLeft]).contains(datum)) return true
        }).sample().value();

        setTimeout(function(){
          elem.attr('src', 'img/'+next.img);
        }, 500);


        return next;
      }

      $(document).ready(function(){
        $('#leftimg').closest('.selectionpanel').find('a').click(function(e){
          console.log("Left clck");
          // We don't want the right one, decrement its popularity
          currentRight.popularity--;
          // But we do want the left one
          currentLeft.popularity++;

          affirm($('#leftimg'), 'rgba(0, 255, 0, 1)');
          affirm($('#rightimg'), 'rgba(255, 0, 0, 1)');
          currentLeft = swapout($("#rightimg"));
        });
        $('#rightimg').closest('.selectionpanel').find('a').click(function(e){
          console.log("Right Clk");

          // We do want the right one
          currentRight.popularity++;
          currentLeft.popularity--;

          affirm($('#rightimg'), 'rgba(0, 255, 0, 1)');
          affirm($('#leftimg'), 'rgba(255, 0, 0, 1)');
          currentRight = swapout($("#leftimg"));
        });

        $('a#imdone').click(function(e){
          var jstring = JSON.stringify(filteredData);

          window.location.replace("results.html?" + $.param({q: jstring}));
        });

        $.getJSON("data.json", function(data){
          console.log("Got", data);
          // Filter data from params
          var age = $.urlParam("age");
          var girls = $.urlParam("girls");
          var boys = $.urlParam("boys");

          if(!boys && !girls) {
            // None selected?
            boys = true;
            girls = true;
          }

          filteredData = _(data).select(function(datum){
            if(boys && _(datum.gender).contains('b')) return true;
            if(girls && _(datum.gender).contains('g')) return true;
          });

          // Start the game
          currentLeft = _(filteredData).sample();
          currentRight = _.chain(filteredData).reject(function(datum){ return datum == currentLeft }).sample().value();

          $('#leftimg').attr('src', "img/" + currentLeft.img);
          $('#rightimg').attr('src', "img/" + currentRight.img);
        })
      })

    </script>
  </head>

  <body>

    <!-- Wrap all page content here -->
    <div id="wrap">

      <!-- Begin page content -->
      <div class="container">
        <div class="page-header">
          <h1>Kids: Pick which one you like</h1>
        </div>

        <div class="row" style="margin-bottom: 40px">
          <div class="selectionpanel col-sm-6 col-md-6">
            <a href="#" class="thumbnail">
              <img id="leftimg" height="200px" src="" alt="...">
            </a>
            <a class="btn btn-primary btn-block">This One</a>
          </div>

          <div class="selectionpanel col-sm-6 col-md-6">
            <a href="#" class="thumbnail">
              <img id="rightimg" height="200px" src="" alt="...">
            </a>
            <a class="btn btn-primary btn-block">This One</a>
          </div>

        </div>

        <div class="row">
          <div class="col-md-4 col-md-offset-4">
<!--             <a class="btn btn-warning">Clear</a>
 -->            <a id="imdone" class="btn btn-success btn-block">I'm Done</a>
          </div>
        </div>

      </div>
    </div>

    <div id="footer" style="margin-top: 40px">
      <div class="container">
        <p class="text-muted credit">TeddyLabs via Startup Seattle (<a href="index.html">Go Home</a>)</p>
      </div>
    </div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
  </body>
</html>
